<script src="products.js"></script>
<script>
const container = document.getElementById("products");
const vaultCount = document.getElementById("vaultCount");
const searchInput = document.getElementById("searchInput");

let vault = JSON.parse(localStorage.getItem("vault")) || [];
vaultCount.textContent = vault.length;

function renderProducts() {
  container.innerHTML = "";

  PRODUCTS.filter(p => p.category === "clothing").forEach(product => {
    const card = document.createElement("div");
    card.className = "product-card";
    card.dataset.id = product.id;
    card.dataset.search = product.search;

    card.innerHTML = `
      <div class="slider">
        ${product.images.map(i => `<img src="${i}">`).join("")}
      </div>
      <div class="details">
        <h2>${product.title}</h2>
        <div class="price">${product.price}</div>
        <div class="short">${product.short}</div>
        <div class="full-description">${product.description}</div>
        <button class="vault-btn">♡ Save to Vault</button>
        <a class="order-btn" href="https://www.instagram.com/oneloveonelifestyle/" target="_blank">
          Buy via Instagram
        </a>
      </div>
    `;

    setupCard(card, product.id);
    container.appendChild(card);
  });
}

function setupCard(card, id) {
  const btn = card.querySelector(".vault-btn");

  if (vault.includes(id)) {
    btn.classList.add("remove");
    btn.textContent = "✕ Remove from Vault";
  }

  card.addEventListener("click", e => {
    if (e.target.closest(".vault-btn") || e.target.closest(".order-btn")) return;
    document.querySelectorAll(".product-card").forEach(c => c.classList.remove("big-product"));
    card.classList.add("big-product");
    container.prepend(card);
  });

  btn.addEventListener("click", e => {
    e.stopPropagation();
    if (vault.includes(id)) {
      vault = vault.filter(v => v !== id);
      btn.textContent = "♡ Save to Vault";
      btn.classList.remove("remove");
    } else {
      vault.push(id);
      btn.textContent = "✕ Remove from Vault";
      btn.classList.add("remove");
    }
    localStorage.setItem("vault", JSON.stringify(vault));
    vaultCount.textContent = vault.length;
  });
}

renderProducts();
</script>
